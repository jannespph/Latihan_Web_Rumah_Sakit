<?php
session_start();
include 'db.php';

// Cek login
if (!isset($_SESSION['username'])) {
  header("Location: login.php");
  exit();
}

// Proses simpan data pasien
if (isset($_POST['simpan'])) {
  $nama = $_POST['nama_pasien'];
  $umur = $_POST['umur'];
  $jk = $_POST['jenis_kelamin'];
  $nohp = $_POST['no_hp'];
  $keluhan = $_POST['keluhan'];
  $tanggal = $_POST['tanggal_kunjungan'];
  $dokter = $_POST['dokter_tujuan'];

  $sql = "INSERT INTO pasien (nama_pasien, umur, jenis_kelamin, no_hp, keluhan, tanggal_kunjungan, dokter_tujuan)
          VALUES ('$nama', '$umur', '$jk', '$nohp', '$keluhan', '$tanggal', '$dokter')";
  $conn->query($sql);
}

// Ambil data pasien
$result = $conn->query("SELECT * FROM pasien ORDER BY id DESC");
?>

<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard - Data Pasien</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 font-sans">

  <!-- Navbar -->
  <nav class="bg-green-600 text-white px-8 py-4 flex justify-between items-center">
    <h1 class="text-2xl font-bold">ğŸ¥ Dashboard Admin</h1>
    <div>
      <span class="mr-4">ğŸ‘¤ <?= $_SESSION['username'] ?></span>
      <a href="logout.php" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded">Logout</a>
    </div>
  </nav>

  <!-- Form Tambah Pasien -->
  <section class="max-w-4xl mx-auto bg-white shadow-lg rounded-2xl p-8 mt-8">
    <h2 class="text-2xl font-bold text-gray-800 mb-6">ğŸ§¾ Tambah Data Pasien</h2>

    <form method="POST" class="grid grid-cols-2 gap-4">
      <div>
        <label class="font-semibold">Nama Pasien</label>
        <input type="text" name="nama_pasien" required class="w-full border p-2 rounded mt-1">
      </div>

      <div>
        <label class="font-semibold">Umur</label>
        <input type="number" name="umur" required class="w-full border p-2 rounded mt-1">
      </div>

      <div>
        <label class="font-semibold">Jenis Kelamin</label>
        <select name="jenis_kelamin" class="w-full border p-2 rounded mt-1">
          <option value="Laki-laki">Laki-laki</option>
          <option value="Perempuan">Perempuan</option>
        </select>
      </div>

      <div>
        <label class="font-semibold">No HP</label>
        <input type="text" name="no_hp" class="w-full border p-2 rounded mt-1">
      </div>

      <div class="col-span-2">
        <label class="font-semibold">Keluhan</label>
        <textarea name="keluhan" rows="2" class="w-full border p-2 rounded mt-1"></textarea>
      </div>

      <div>
        <label class="font-semibold">Tanggal Kunjungan</label>
        <input type="date" name="tanggal_kunjungan" required class="w-full border p-2 rounded mt-1">
      </div>

      <div>
        <label class="font-semibold">Dokter Tujuan</label>
        <input type="text" name="dokter_tujuan" required class="w-full border p-2 rounded mt-1" placeholder="Dr. Jannes">
      </div>

      <div class="col-span-2 text-right">
        <button type="submit" name="simpan" class="bg-green-500 hover:bg-green-600 text-white px-6 py-2 rounded-lg">
          ğŸ’¾ Simpan Data
        </button>
      </div>
    </form>
  </section>

  <!-- Tabel Data Pasien -->
  <section class="max-w-5xl mx-auto bg-white shadow-lg rounded-2xl p-6 mt-10 mb-12">
    <h2 class="text-xl font-bold text-gray-800 mb-4">ğŸ“‹ Daftar Pasien</h2>

    <table class="w-full border text-sm text-left">
      <thead class="bg-green-500 text-white">
        <tr>
          <th class="p-2">No</th>
          <th class="p-2">Nama Pasien</th>
          <th class="p-2">Umur</th>
          <th class="p-2">JK</th>
          <th class="p-2">No HP</th>
          <th class="p-2">Dokter Tujuan</th>
          <th class="p-2">Tanggal</th>
          <th class="p-2">Keluhan</th>
        </tr>
      </thead>
      <tbody>
        <?php $no=1; while($row = $result->fetch_assoc()): ?>
          <tr class="border-b hover:bg-gray-100">
            <td class="p-2"><?= $no++ ?></td>
            <td class="p-2"><?= $row['nama_pasien'] ?></td>
            <td class="p-2"><?= $row['umur'] ?></td>
            <td class="p-2"><?= $row['jenis_kelamin'] ?></td>
            <td class="p-2"><?= $row['no_hp'] ?></td>
            <td class="p-2"><?= $row['dokter_tujuan'] ?></td>
            <td class="p-2"><?= $row['tanggal_kunjungan'] ?></td>
            <td class="p-2"><?= $row['keluhan'] ?></td>
          </tr>
        <?php endwhile; ?>
      </tbody>
    </table>
  </section>

</body>
</html>
